{"title":"$:/plugins/linonetwo/redirect-to-lan-host","description":"Redirect to lan host, so QR Code is useable","author":"LinOnetwo","core-version":">=5.1.22","plugin-type":"plugin","version":"0.0.1","list":"readme","dependents":"","type":"application/json","text":"{\n    \"tiddlers\": {\n        \"$:/plugins/linonetwo/redirect-to-lan-host/get-lan-ip\": {\n            \"title\": \"$:/plugins/linonetwo/redirect-to-lan-host/get-lan-ip\",\n            \"text\": \"const os = require('os');\\nconst ifaces = os.networkInterfaces();\\n\\nconst addresses = [];\\n// https://stackoverflow.com/questions/3653065/get-local-ip-address-in-node-js\\nObject.keys(ifaces).forEach(function (ifname) {\\n  let alias = 0;\\n\\n  ifaces[ifname].forEach(function (iface) {\\n    if ('IPv4' !== iface.family || iface.internal !== false) {\\n      // skip over internal (i.e. 127.0.0.1) and non-ipv4 addresses\\n      return;\\n    }\\n\\n    const serveURL = `http://${iface.address}`;\\n    if (alias >= 1) {\\n      // this single interface has multiple ipv4 addresses\\n      addresses.push({ name: `${ifname}:{alias}`, url: serveURL });\\n    } else {\\n      // this interface has only one ipv4 adress\\n      addresses.push({ name: ifname, url: serveURL });\\n    }\\n    ++alias;\\n  });\\n});\\n\\ncontextBridge.exposeInMainWorld('server', {\\n  addresses,\\n});\\n\",\n            \"created\": \"20200621073819821\",\n            \"creator\": \"LinOnetwo\",\n            \"modified\": \"20200621074334657\",\n            \"modifier\": \"LinOnetwo\",\n            \"tags\": \"InjectJS\",\n            \"type\": \"application/javascript\"\n        },\n        \"$:/plugins/linonetwo/redirect-to-lan-host/readme\": {\n            \"title\": \"$:/plugins/linonetwo/redirect-to-lan-host/readme\",\n            \"created\": \"20200414135748497\",\n            \"modified\": \"20200602062349232\",\n            \"creator\": \"LinOnetwo\",\n            \"type\": \"text/vnd.tiddlywiki\",\n            \"text\": \"!! 动机\\n\\n我想用 `tiddlywiki/qrcode` 插件来让我的手机和平板能在家里扫码打开电脑上的 Wiki，从而能用平板做一些快速的数据录入，但是这个插件生成的二维码指向的是 `localhost`，这让它变得很鸡肋。\\n\\n所以我通过 WebCatalog 的 InjectJS 功能，注入以下代码\\n\\n{{$:/plugins/linonetwo/redirect-to-lan-host/get-lan-ip}}\\n\\n然后本插件就会自动刷新 URL 了。\\n\"\n        },\n        \"$:/plugins/linonetwo/redirect-to-lan-host/redirect-to-lan-host.html\": {\n            \"title\": \"$:/plugins/linonetwo/redirect-to-lan-host/redirect-to-lan-host.html\",\n            \"text\": \"<script type=\\\"application/javascript\\\">\\n  function redirectToLANHost() {\\n    const lanURL = window.server?.addresses?.[0]?.url;\\n    if (!lanURL) {\\n      // still not set up\\n      return setTimeout(redirectToLANIP, 500);\\n    }\\n    if (lanURL && `${location.protocol}//${location.hostname}` !== lanURL) {\\n      window.location.replace(`${lanURL}:${location.port}${location.hash}`);\\n    }\\n  }\\n\\n  setTimeout(redirectToLANHost, 500);\\n</script>\\n\",\n            \"type\": \"text/html\",\n            \"creator\": \"LinOnetwo\",\n            \"tags\": \"$:/tags/RawMarkup\"\n        }\n    }\n}"}